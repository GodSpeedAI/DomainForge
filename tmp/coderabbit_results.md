Starting CodeRabbit review in plain text mode...

Connecting to review service
Setting up
Analyzing
Reviewing

============================================================================
File: docs/plans/Enhancements-Hardening.md
Line: 75 to 76
Type: potential_issue

[ ] Task:
In docs/plans/Enhancements-Hardening.md around lines 75-76 (and also affecting lines 113-114), the grammar rule uses a lowercase token ^"dimension" but the example uses a capitalized "Dimension"; make them consistent by either changing the grammar token to match the example (e.g., update the rule to ^"Dimension" if tokens are case-sensitive) or update the example at lines 113-114 to use lowercase (dimension "Currency") so the declared grammar and the example match; apply the same consistency check and fix for the related unit_decl/example instances if present.

============================================================================
File: docs/plans/Enhancements-Hardening-plan.md
Line: 16
Type: potential_issue

[ ] Task:
In docs/plans/Enhancements-Hardening-plan.md around line 16 (and likewise lines 41, 69, 93), the Status markers currently show "âœ… Implemented" which conflicts with the document's planning tone; update the status labels to clearly indicate intent: if this is a prospective plan, change statuses to planned/in-progress symbols (e.g., "â¬œ Planned", "ðŸ”„ In Progress") and remove file/line implementation references; if it documents completed work, keep "âœ… Implemented" but add a date/version and brief note referencing the commit or release that completed it; make the same change consistently at the other referenced lines (41, 69, 93).

============================================================================
File: docs/plans/Enhancements-Hardening.md
Line: 164
Type: potential_issue

[ ] Task:
In docs/plans/Enhancements-Hardening.md around line 164, the file currently self-references "Full plan: docs/plans/Enhancements-Hardening.md (generated by plan_task tool)"; remove or replace this self-referential link with either a substantive external reference (e.g., a different doc or tooling README) or rephrase to clarify intent (for example, "This plan was generated by the plan_task tool â€” see docs/tools/plan_task.md for details"); update the line accordingly and ensure any referenced path actually points to an existing file.

============================================================================
File: .github/workflows/ci.yml
Line: 34 to 49
Type: nitpick

[ ] Task:
.github/workflows/ci.yml lines 34-49 and 155-162: the cargo cache paths are inconsistent between the generic cache steps and the test-typescript job; update the test-typescript job to use the same cache paths as the other jobs (include ~/.cargo/registry/index, ~/.cargo/registry/cache, ~/.cargo/git/db and the appropriate target directory such as sea-core/target), and ensure its cache key/restore-keys mirror the pattern used by the other cargo cache steps so all jobs share the same cache semantics.

============================================================================
File: sea-core/src/concept_id.rs
Line: 1 to 48
Type: nitpick

[ ] Task:
In sea-core/src/concept_id.rs around lines 1 to 48, both from_uuid() and from_legacy_uuid() are identical; either remove one to avoid redundancy or keep both but add a short doc comment to explain the semantic difference and intended use of from_legacy_uuid(). If you consolidate, remove from_legacy_uuid(), update any callers to use from_uuid(), and remove its impl if unused; if you keep it, add a /// doc comment above from_legacy_uuid() clarifying when legacy UUIDs should be used so the duplicate implementation is justified.

============================================================================
File: .github/workflows/ci.yml
Line: 17 to 18
Type: potential_issue

[ ] Task:
In .github/workflows/ci.yml around lines 17-18 (and apply same change to lines 123-126), the MATURIN_VERSION and PYTEST_VERSION env vars are declared but not used; update the pip install command to reference these environment variables so versions are pinned (e.g., install maturin==${{ env.MATURIN_VERSION }} and pytest==${{ env.PYTEST_VERSION }}), ensure the syntax matches the workflow shell/runner context and that any existing unpinned package specs are replaced with the env-var pinned versions.

============================================================================
File: sea-core/src/primitives/entity.rs
Line: 65 to 84
Type: potential_issue

[x] Done:
Added `#[deprecated(...)]` attribute to `Entity::new` and updated doc examples and callsites to use `Entity::new_with_namespace(..., "default")`. Ran `cargo test` locally to verify no regressions; callers now receive deprecation warnings as intended.

============================================================================
File: sea-core/tests/entity_tests.rs
Line: 23 to 27
Type: potential_issue

============================================================================
File: docs/plans/Enhancements-Hardening-plan.md
Line: 115 to 120
Type: potential_issue

[ ] Task:
In docs/plans/Enhancements-Hardening-plan.md around lines 115â€“120, the Quantifier Module section is truncated and the Validation Error header has no content; finish Task 2.1 by describing the Validation Error changes (add a ValidationError variant that carries a QuantifierExpansionTrace, update sea-core/src/validation_error.rs to include the new struct/variant and serialization/display logic), specify logging details and evaluation signature changes (expand evaluate/expand functions to return or accept a QuantifierExpansionTrace or a mutable trace collector, log collection size, list of substituted variables, and each generated sub-expression with context), and complete all remaining Phase 2 tasks and subsequent phases by adding clear bulletized entries for each task (implementation steps, API changes, tests, migrations, and rollout notes) so no section header ends mid-sentence. Ensure each header now has full explanatory content describing what to change in code, tests to add, and expected behavioral outcome.

============================================================================
File: .github/workflows/ci.yml
Line: 205 to 216
Type: potential_issue

[ ] Task:
.github/workflows/ci.yml around lines 205 to 216: the workflow uses the Linux-specific command stat -c%s to get the wasm file size which fails on macOS; replace it with a portable approach such as using wc -c (e.g. SIZE=$(wc -c < "sea-core/pkg/sea_core_bg.wasm" | tr -d '[:space:]')) or invoking a small Rust/node script that prints file length, then keep the existing numeric validation and size-check logic and ensure you handle the file-missing case (error out if file not present or SIZE is empty/non-numeric).

============================================================================
File: sea-core/tests/entity_tests.rs
Line: 17 to 21
Type: nitpick

[ ] Task:
In sea-core/tests/entity_tests.rs around lines 17 to 21, the test passes the namespace as a string literal ("logistics") while the rest of tests use .to_string(); change the literal to "logistics".to_string() so the parameter style matches other tests and keep the assertion unchanged.

============================================================================
File: sea-core/src/wasm/graph.rs
Line: 44 to 49
Type: refactor_suggestion

============================================================================
File: docs/implementation/PHASE_7_REPORT.md
Line: 144 to 145
Type: potential_issue

[ ] Task:
In docs/implementation/PHASE_7_REPORT.md around lines 144-145, the documented build uses "maturin develop" but the review notes the "--features python" flag was removed and Python bindings may not be compiled by default; either restore the flag to the command (use "maturin develop --features python"), or make the python feature enabled by default in Cargo.toml under [features], or add a [tool.maturin] section in pyproject.toml with features = ["python"]; update the documentation to show the chosen approach so the build actually produces Python bindings.

============================================================================
File: docs/plans/Enhancements-Hardenening.md
Line: 1
Type: potential_issue

[ ] Task:
In docs/plans/Enhancements-Hardenening.md (entire file) and specifically at line 849, fix two typos: rename the file to docs/plans/Enhancements-Hardening.md (update any imports/links or references accordingly) and edit line 849 to change "Trunck-based Development" to "Trunk-based Development"; commit the filename change so repository references update and run a quick search to ensure no other occurrences remain.

============================================================================
File: docs/plans/tmp/task-06-rdf-sbvr-escaping.md
Line: 640 to 653
Type: nitpick

[ ] Task:
In docs/plans/tmp/task-06-rdf-sbvr-escaping.md around lines 640 to 653, the escape_xml() function correctly escapes the five core XML entities but lacks documentation about its scope; add a Rust doc comment above the function stating it escapes the 5 core XML entities per W3C XML spec Â§2.4 and that it does not perform numeric character references or handle named entities beyond those five, leaving the implementation unchanged.

============================================================================
File: docs/plans/tmp/task-06-rdf-sbvr-escaping.md
Line: 655 to 658
Type: potential_issue

[ ] Task:
In docs/plans/tmp/task-06-rdf-sbvr-escaping.md around lines 655 to 658, the TypedLiteralSuffix enum is currently declared in the wrong scope; make it accessible where parse_typed_literal() is defined/used (lines ~605â€“606 and 662â€“711) by either moving the enum into the impl block if parse_typed_literal() is an impl method, or by defining it at module level with appropriate visibility (add pub if used from other modules); update any references/imports accordingly so the enum is in scope for parse_typed_literal().

============================================================================
File: docs/plans/tmp/task-06-rdf-sbvr-escaping.md
Line: 640
Type: potential_issue

[ ] Task:
In docs/plans/tmp/task-06-rdf-sbvr-escaping.md around lines 640 and 662, the functions escape_xml and parse_typed_literal are defined as free functions but are called as Self::escape_xml and Self::parse_typed_literal at lines 605â€“606 and 920â€“927, causing compile errors; fix by moving the current free-function bodies into impl KnowledgeGraph as methods named fn escape_xml(&self, input: &str) -> String (or keep it as fn escape_xml(input: &str) -> String but placed inside the impl) and fn parse_typed_literal(&self, literal: &str) -> (String, Option) (or the non-self signature inside impl if no self used), remove the external free-function definitions, and ensure all call sites keep Self::... (alternatively, if you prefer module-level functions, remove the Self:: prefix at all call sites listed instead).

============================================================================
File: .pre-commit-config.yaml
Line: 44
Type: nitpick

[ ] Task:
.pre-commit-config.yaml around line 44: the exclude regex currently is unanchored and can match substrings (e.g. my_target.ts); update the pattern to anchor directory boundaries so it only excludes those top-level directories or path segments â€” replace the current pattern with one that requires a start or slash before the directory name and a slash or end after it (e.g. use a pattern like '(^|/)(node_modules|pkg|target|sea-core/target)(/|$)').

============================================================================
File: sea-core/tests/aggregation_parser_tests.rs
Line: 73 to 81
Type: nitpick

[ ] Task:
In sea-core/tests/aggregation_parser_tests.rs around lines 73 to 81, the test only checks that parsing succeeds and one declaration exists; enhance it to assert the parsed AST structure for the comprehension: locate the Policy declaration, downcast to the aggregation/comprehension node, assert the variable binding name is "f", assert the filter condition is a binary equality comparing f.resource to the string "Money", and assert the comprehension expression accesses f.quantity and that the top-level aggregation is a sum with the comprehension as its argument. Ensure any pattern matches or unwraps are guarded with clear test failures.

============================================================================
File: .pre-commit-config.yaml
Line: 42 to 43
Type: nitpick

[ ] Task:
.pre-commit-config.yaml around lines 42 to 43: the Pre-commit hook block redundantly specifies both types_or and a files regex that duplicates those extensions; remove the files: '\.(js|ts|json|md)$' entry so the hook relies on types_or: [javascript, typescript, json, markdown] only, leaving the rest of the hook configuration unchanged.

============================================================================
File: sea-core/src/python/graph.rs
Line: 35 to 57
Type: refactor_suggestion

[ ] Task:
In sea-core/src/python/graph.rs around lines 35 to 57, the add_* methods currently call .map_err(PyValueError::new_err) with no contextual message; change each to map the error into a PyValueError with a helpful prefix (for example, map_err(|e| PyValueError::new_err(format!("Add entity error: {}", e)))) so the Python exception includes context; apply the same pattern to add_resource, add_flow and add_instance (use "Add resource error:", "Add flow error:", "Add instance error:" respectively) so errors are consistent and debuggable.

============================================================================
File: sea-core/tests/aggregation_parser_tests.rs
Line: 83 to 91
Type: nitpick

[ ] Task:
In sea-core/tests/aggregation_parser_tests.rs around lines 83 to 91, the test currently only asserts the declaration count; add assertions to inspect the parsed AST to ensure unit coercion is captured: extract the single declaration's expression, navigate to the aggregation comprehension node and assert the inner expression contains a coercion of f.quantity to unit "USD", and additionally assert the comparison uses the literal 1000 with unit "USD"; use pattern matching or downcasting on the AST node types to check the coercion node and unit string/value fields so the test fails if unit coercion is not present or parsed incorrectly.

============================================================================
File: sea-core/tests/instance_tests.rs
Line: 23 to 25
Type: potential_issue

[ ] Task:
In sea-core/tests/instance_tests.rs around lines 23 to 25, the test only asserts the ID strings are non-empty but the test name claims "valid_uuids"; replace those non-empty checks with real UUID validation by attempting to parse each string as a UUID (e.g., using uuid::Uuid::parse_str) and asserting the parse returns Ok for instance.id(), instance.resource_id(), and instance.entity_id(); ensure any necessary crate import (uuid) is present in the test module.

============================================================================
File: sea-core/src/policy/expression.rs
Line: 100 to 180
Type: refactor_suggestion

[ ] Task:
In sea-core/src/policy/expression.rs around lines 100 to 180, add two missing constructor helpers to the impl Expression block: one named quantity_literal that takes a Decimal value and a unit (impl Into) and returns Expression::QuantityLiteral with the unit converted via into(); and another named aggregation_comprehension that takes function: AggregateFunction, variable: impl Into, collection: Expression, predicate: Expression, projection: Expression, and target_unit: Option> and returns Expression::AggregationComprehension with variable converted via into(), collection/predicate/projection boxed, and target_unit mapped with .map(|u| u.into()).

============================================================================
File: docs/plans/Enhancements-Hardenening.md
Line: 734 to 754
Type: potential_issue

============================================================================
File: Cargo.toml
Line: 7 to 12
Type: potential_issue

[ ] Task:
In Cargo.toml around lines 7 to 12, the release profile block is redundant because the workspace root already defines the same profile and per Cargo semantics workspace members inherit it; remove the duplicate [profile.release] section from this member crate (sea-core) so the crate relies on the workspace profile and avoid confusion, i.e., delete lines 7â€“12 in Cargo.toml for this member.

============================================================================
File: sea-core/tests/graph_tests.rs
Line: 420 to 425
Type: potential_issue

[x] Done:
Updated the test examples to call `Entity::new_with_namespace(..., "default")` (and analogous `Resource::new_with_namespace` where relevant). Verified `cargo test -p sea-core` â€” tests pass.

============================================================================
File: sea-core/src/primitives/resource.rs
Line: 81 to 95
Type: nitpick

[ ] Task:
In sea-core/src/primitives/resource.rs around lines 81 to 95, the docstring marks the function as deprecated but the Rust #[deprecated] attribute is missing; add a #[deprecated(note = "Use new_with_namespace instead", since = "")] attribute immediately above the pub fn new(...) declaration (replace  with the current crate version or omit the since field if unknown) so callers get a compiler warning and the note directs them to the replacement API.

============================================================================
File: docs/plans/Enhancements-Hardenening.md
Line: 678 to 705
Type: potential_issue

[ ] Task:
docs/plans/Enhancements-Hardenening.md lines 678-705: expand each mitigation into concrete, actionable safeguards: for Breaking Changes, add a short tooling spec for sea migrate (CLI flags, input/output formats, dry-run mode, error reporting, automated CI migration job and rollback plan) and require deprecation warnings with exact timeline and compatibility matrix; for Performance Regression, specify benchmarking harness (commands, representative workloads, metric definitions e.g., p95 latency, memory), add pass/fail thresholds, CI performance gate that fails PRs beyond thresholds, and describe cache invalidation strategy (cache key, scope: per-file, TTL, metrics to monitor); for Projection Drift, define schema-version locking in Cargo.toml (how versions are pinned), store frozen fixtures in a versioned directory with Git tags and a policy for updating fixtures (review checklist + automated diff test), add a CI job to run schema validation and compatibility tests against frozen fixtures, and include monitoring/alerts and a rollback plan for export drift incidents.

============================================================================
File: sea-core/src/policy/mod.rs
Line: 1
Type: refactor_suggestion

[ ] Task:
In sea-core/src/policy/mod.rs around lines 1â€“6, the local module is named core which shadows Rust's stdlib core; rename the module declaration from mod core; to mod policy_core;, rename the file sea-core/src/policy/core.rs to sea-core/src/policy/policy_core.rs, and update any internal references/imports in the policy module or other crates that referenced policy::core to use policy::policy_core (or adjust pub use re-exports as needed) so compilation and imports continue to work.

============================================================================
File: docs/plans/Enhancements-Hardenening.md
Line: 600 to 639
Type: potential_issue

============================================================================
File: sea-core/src/uuid_module.rs
Line: 4 to 6
Type: nitpick

[ ] Task:
In sea-core/src/uuid_module.rs around lines 4 to 6, the function uses the fully-qualified call uuid::Uuid::now_v7() even though Uuid is already imported at line 1; replace the redundant namespace-qualified call with the local Uuid::now_v7() invocation to remove the unnecessary qualifier while preserving behavior.

============================================================================
File: sea-core/src/python/policy.rs
Line: 4
Type: potential_issue

[ ] Task:
In sea-core/src/python/policy.rs at around line 4, the #[pyclass(eq, eq_int)] attribute should be changed to remove eq_int because it exposes implicit integer values for enum variants which can silently break API; delete eq_int from the attribute list (leaving #[pyclass(eq)]) and, if integer conversion is an explicit API requirement, implement an explicit __int__/to_int method or a stable mapping function and update any callers/tests to use that instead of relying on implicit integer discriminants.

============================================================================
File: sea-core/src/graph/mod.rs
Line: 275
Type: potential_issue

[ ] Task:
In sea-core/src/graph/mod.rs around line 275, there's inconsistent access of Policy's identifier using direct field access policy.id; change this to use the same accessor pattern as other entities by calling policy.id() (or, if Policy intentionally exposes a public field, add a short comment documenting why Policy differs and keep access consistent across the module). Ensure imports/traits provide the id() method and update surrounding code to use the method form for consistency.

============================================================================
File: .cargo/config.toml
Line: 6
Type: refactor_suggestion

[ ] Task:
In .cargo/config.toml around line 6, remove the rustflags cfg workaround that forces getrandom_backend="wasm_js" and instead enable the wasm_js feature for getrandom in Cargo.toml; update Cargo.toml dependency to use getrandom = { version = "0.3", features = ["wasm_js"] } (or add the features array if getrandom is already declared), then delete the rustflags entry from .cargo/config.toml so the crate selection is driven by Cargo features rather than compiler cfg flags.

============================================================================
File: sea-core/src/python/primitives.rs
Line: 308 to 318
Type: potential_issue

[ ] Task:
In sea-core/src/python/primitives.rs around lines 308 to 318, Instance::new currently calls RustInstance::new when namespace is None which differs from Entity::new and Resource::new that explicitly pass "default" as the namespace; change the None branch to call RustInstance::new_with_namespace(..., "default".to_string() or String::from("default")) so Instance uses the same explicit "default" namespace fallback as Entity and Resource.

============================================================================
File: docs/plans/Enhancements-Hardenening.md
Line: 758 to 774
Type: potential_issue

[ ] Task:
In docs/plans/Enhancements-Hardenening.md around lines 758 to 774, the "Open Questions" list lacks explicit decision dates, owners, and fallback outcomes; update each bullet to include a named decision owner (role or person), a firm decision-by date (YYYY-MM-DD), and a fallback/default decision if the deadline passes, and add a short "Decision recorded" line template to capture final choice and date; ensure the format is consistent for all items and add a note to the top of the section that unanswered items will be auto-escalated to the project lead after the decision date and logged in the project changelog.

============================================================================
File: QUICKSTART_WASM.md
Line: 124 to 132
Type: potential_issue

============================================================================
File: index.d.ts
Line: 48 to 49
Type: refactor_suggestion

[ ] Task:
In index.d.ts around lines 48-49, the methods findEntityByName and findResourceByName return string | null (IDs) but their names imply returning full objects; update the Rust implementation and regenerating types to make naming and types consistent: either rename the methods to findEntityIdByName and findResourceIdByName in both Rust and the generated d.ts, or change their return types in Rust to return Entity | null and Resource | null and then regenerate index.d.ts so the declarations reflect the chosen option.

============================================================================
File: sea-core/src/units/mod.rs
Line: 99 to 101
Type: potential_issue

[ ] Task:
In sea-core/src/units/mod.rs around lines 99-101, convert_from_base divides by self.base_factor but Unit::new currently allows a zero base_factor which will panic; change Unit::new to validate base_factor != Decimal::ZERO and return Result (add a UnitError::ZeroBaseFactor variant if needed), return Err when base_factor is zero, keep convert_from_base unchanged because the constructor guarantee prevents division-by-zero, and update all Unit::new call sites to handle the Result.

============================================================================
File: sea-core/src/units/mod.rs
Line: 347 to 356
Type: potential_issue

============================================================================
File: docs/plans/tmp/task-06-rdf-sbvr-escaping.md
Line: 1025 to 1034
Type: potential_issue

[ ] Task:
In docs/plans/tmp/task-06-rdf-sbvr-escaping.md around lines 1025 to 1034, the SbvrFactType instances are built without the required schema_version field; add a schema_version entry to the struct initialization (e.g. schema_version: SbvrFactType::default().schema_version.clone() or schema_version: DEFAULT_SCHEMA_VERSION.to_string() / "v1".to_string(), whichever matches the project constant) so the struct satisfies its definition.

============================================================================
File: sea-core/src/wasm/primitives.rs
Line: 174 to 198
Type: potential_issue

[ ] Task:
In sea-core/src/wasm/primitives.rs around lines 174 to 198, the Flow #[wasm_bindgen(constructor)] is missing a namespace parameter which makes construction inconsistent with Entity/Resource/Instance; update the constructor signature to accept namespace: Option, validate/accept it similarly to the other types (no parsing needed beyond Option), then pass it into the underlying RustFlow creation (call RustFlow::new_with_namespace(namespace_map) or use the appropriate RustFlow constructor or setter that accepts a namespace) and ensure any error mapping to JsValue follows the same pattern as the other parameters; adjust the call site so the new namespace argument is forwarded and the returned Flow remains Ok(Self { inner: flow }).

============================================================================
File: sea-core/src/primitives/resource.rs
Line: 90 to 93
Type: potential_issue

[ ] Task:
In sea-core/src/primitives/resource.rs around lines 90 to 93, the doc example asserts resource.unit().symbol() == "kg" but the Unit::new call uses "kilogram" as the symbol argument, so the assertion is wrong; update the doc example to assert the actual symbol (change the assertion to assert_eq!(resource.unit().symbol(), "kilogram")) or alternatively swap the Unit::new arguments so the symbol is "kg" to match the original assertionâ€”prefer updating the assertion to "kilogram" to match the current constructor call.

============================================================================
File: sea-core/src/calm/import.rs
Line: 103 to 107
Type: potential_issue

[x] Done:
Updated CALM import logic to create resources using `Resource::new_with_namespace(..., "default")` when `node.namespace` is missing. Verified round-trip CALM import/export and ran related tests; no regressions found.

============================================================================
File: sea-core/src/calm/import.rs
Line: 136 to 140
Type: potential_issue

[ ] Task:
In sea-core/src/calm/import.rs around lines 136 to 140, the Instance construction falls back to Instance::new() when node.namespace is None, causing inconsistent namespace defaulting; change the else branch to call the namespace-aware constructor (Instance::new_with_namespace) and pass the literal "default" as the namespace (using the same cloned resource_id and entity_id values) so instances follow the same explicit "default" namespace behavior as entities.

============================================================================
File: sea-core/tests/calm_round_trip_tests.rs
Line: 153 to 216
Type: nitpick

[ ] Task:
In sea-core/tests/calm_round_trip_tests.rs around lines 153 to 216, the test only compares flow counts after round-trip but not the individual flow details; update the test to fetch the flow(s) from both original_graph and imported_graph and add assertions that the flow's resource id, source id, destination id, and quantity are preserved (e.g., quantity equals Decimal::new(2500, 2) and source/destination/resource ids match the original r1_id/e1_id/e2_id); ensure you handle indexing or lookup consistently (e.g., get the single flow from .all_flows() or find by ids) and assert equality for each field so the round-trip preserves full flow semantics.

============================================================================
File: sea-core/tests/graph_integration_tests.rs
Line: 13 to 16
Type: nitpick

[ ] Task:
In sea-core/tests/graph_integration_tests.rs around lines 13-16 (and also update occurrences at lines 93, 115, 141, and 142), extract the repeated namespace string into a single file-level constant and replace each "default".to_string() with that constant's to_string() call; add e.g. const DEFAULT_NS: &str = "default"; near the top of the file and change all nine occurrences to DEFAULT_NS.to_string() to avoid redundant allocations.

============================================================================
File: docs/plans/Enhancements-Hardenening.md
Line: 643 to 674
Type: potential_issue

[ ] Task:
In docs/plans/Enhancements-Hardenening.md around lines 643 to 674, the success criteria are vague and need concrete baseline/target pairs and validation methods; update each checkbox to include (1) a measurable baseline value, (2) a target value, (3) the scope (files/modules/hardware) and (4) the validation method and acceptance test. For example, change items like test coverage to "baseline: X% current (run coverage tool on core modules), target: 95% on parser, policy, units; validation: CI coverage report", CLI latency to "baseline: measured median on CI runner type (e.g., GitHub Actions ubuntu-latest) for a 1K-line file, target: <100ms, validation: 1000-run benchmark in CI", error messages to "baseline: current % with source location; target: 100% include location+suggestion+fix-it where applicable; validation: automated lint that scans compiled diagnostics", and similarly specify limits/hardware and test harness for each non-functional/quality gate entry so each checkbox is a verifiable baselineâ†’target pair with a defined validation procedure.

============================================================================
File: sea-core/src/parser/ast.rs
Line: 1037
Type: potential_issue

[ ] Task:
In sea-core/src/parser/ast.rs around line 1037, the inline comment currently reads "Second pass: Add flows" but this is the third pass; update the comment to "Third pass: Add flows" (or an equivalent accurate wording) so the comment reflects the actual pass order.

============================================================================
File: sea-core/src/wasm/primitives.rs
Line: 57 to 63
Type: potential_issue

============================================================================
File: sea-core/src/parser/ast.rs
Line: 249 to 305
Type: potential_issue

[ ] Task:
In sea-core/src/parser/ast.rs around lines 249 to 305: the parser currently ignores an unexpected second token after an identifier (comment at line ~288) instead of returning an error, allowing malformed resource declarations to pass silently; update the match that handles the optional second token so that if second.as_rule() is not Rule::in_keyword you return Err(ParseError::GrammarError(format!("Unexpected token '{}' after unit name in resource declaration", second.as_rule()))), ensuring you consume or reference the unexpected token safely and provide a clear error message (use second.as_rule() or similar to include the actual rule name).

============================================================================
File: sea-core/src/parser/ast.rs
Line: 1067 to 1124
Type: nitpick

[ ] Task:
In sea-core/src/parser/ast.rs around lines 1067 to 1124, add the missing pass comment before the policy loop to match the other pass comments; insert a single-line comment (e.g., "// Third pass: Add policies") immediately above the for node in &ast.declarations { ... } block (around line 1068) so the pass is clearly labeled and consistent with the surrounding code.

============================================================================
File: docs/plans/tmp/task-07-fix-api-robustness.md
Line: 1654 to 1670
Type: potential_issue

============================================================================
File: docs/plans/tmp/task-07-fix-api-robustness.md
Line: 832 to 847
Type: potential_issue

[ ] Task:
In docs/plans/tmp/task-07-fix-api-robustness.md around lines 832 to 847, the call to self._node_text(function_node).decode() is unguarded and can raise RuntimeError when source_code isn't initialized; wrap that call in a try/except, on exception call logger.debug("Skipping call_expression at bytes %s-%s: %s", node.start_byte, node.end_byte, exc) and skip processing, and only compare path_text to 'Resource::new' and append the node when decode succeeds.

============================================================================
File: sea-core/fix_api_v2.py
Line: 633 to 667
Type: refactor_suggestion

============================================================================
File: sea-core/grammar/sea.pest
Line: 165 to 168
Type: potential_issue

============================================================================
File: docs/plans/tmp/task-07-fix-api-robustness.md
Line: 1554 to 1556
Type: potential_issue

[ ] Task:
In docs/plans/tmp/task-07-fix-api-robustness.md around lines 1554 to 1556, the code currently accepts files with suffix '.rs.bak' which is undesirable; change the validation to only allow '.rs' files and update the error message accordingly so it says "Input file must be a Rust source file (ends with .rs): %s" and exit on other suffixes.

============================================================================
File: docs/plans/tmp/task-07-fix-api-robustness.md
Line: 490 to 500
Type: potential_issue

[ ] Task:
In docs/plans/tmp/task-07-fix-api-robustness.md around lines 490 to 500, the test uses an invalid Rust call Entity::new("Warehouse".to_string(), metadata.clone()) yet the transformer assumes one argument; either update the test to assert no transformation occurs for mismatched signatures, or (preferable) add argument-count validation in the EntityTransformer: after extracting argument_nodes check if len(argument_nodes) != 1, log a warning with the argument count and byte range, and return/skip transformation so invalid Entity::new calls are left untouched.

============================================================================
File: docs/plans/tmp/task-07-fix-api-robustness.md
Line: 1582
Type: nitpick

[ ] Task:
In docs/plans/tmp/task-07-fix-api-robustness.md around line 1582, the code currently hard-codes adding 'unit_from_string' which prevents adding different imports when other transformers are active; modify main() to accept or build a required_imports list based on parsed_args.transform (e.g., if 'entity' in transform or transform == 'all' add 'Entity'; if 'resource' in transform or transform == 'all' add 'unit_from_string', etc.), then iterate over required_imports and call ImportInserter().add_import(source_code, import_name) for each item (you can reuse a single inserter instance or recreate per import), replacing the single hard-coded inserter.add_import call so imports are parameterized by active transformers.

============================================================================
File: sea-core/grammar/sea.pest
Line: 13 to 15
Type: potential_issue

============================================================================
File: sea-core/fix_api_v2.py
Line: 529 to 540
Type: potential_issue

[ ] Task:
In sea-core/fix_api_v2.py around lines 529 to 540, the exception handlers currently call sys.exit(1) which terminates the process and prevents this function from being used as a library; remove the sys.exit(1) calls and instead re-raise the caught exceptions (or raise a more specific custom exception) so callers can handle them, and move any process-exiting logic into the CLI entrypoint (main()) where you should catch these exceptions and call sys.exit(1) with an appropriate message.

============================================================================
File: docs/plans/tmp/task-07-fix-api-robustness.md
Line: 1143 to 1146
Type: potential_issue

============================================================================
File: sea-core/fix_api_v2.py
Line: 205 to 219
Type: potential_issue

[ ] Task:
In sea-core/fix_api_v2.py around lines 205 to 219, the change currently hardcodes adding "default".to_string() which can conflict with the repository's preferred string-construction style; update the code to either detect the project's existing pattern or accept a CLI/config option for the style, then generate the replacement string using that chosen style (e.g., String::from("default"), "default".into(), or "default".to_owned()) instead of the fixed .to_string(), and use the detected/configured formatter when building new_args before appending to self.changes.

============================================================================
File: sea-core/src/policy/quantifier.rs
Line: 181 to 195
Type: potential_issue

[ ] Task:
In sea-core/src/policy/quantifier.rs around lines 181 to 195, the AggregationComprehension substitution incorrectly substitutes variables in the predicate and projection expressions without checking if the substitution variable matches the bound variable. Add a check at the beginning of this match arm to compare if var == variable. If they match, return the AggregationComprehension unchanged without performing substitution on predicate and projection, as these expressions are in the scope of the bound variable and should not be modified. Only perform the current substitution logic if var != variable.

============================================================================
File: docs/plans/tmp/task-07-fix-api-robustness.md
Line: 311 to 351
Type: potential_issue

============================================================================
File: sea-core/fix_api_v2.py
Line: 119 to 142
Type: potential_issue

[ ] Task:
In sea-core/fix_api_v2.py around lines 119 to 142, the fallback currently returns (None, source_code) which breaks callers expecting a Tree; replace the silent fallback with a fail-fast behavior by raising a clear exception (e.g., RuntimeError or custom exception) that includes the filepath and a short summary (number of imports/functions/comments found and/or the synthesized snippets) so callers can handle the failure; remove or incorporate the unused use_statements/fn_signatures/comment_text into the exception message for debugging, and ensure the function never returns None as the Tree component.

============================================================================
File: sea-core/src/policy/quantifier.rs
Line: 566
Type: nitpick

[ ] Task:
In sea-core/src/policy/quantifier.rs at line 566, the AggregateFunction::Count case in the fold_numeric function appears to be unreachable because evaluate_aggregation_comprehension at line 485 handles Count separately and never calls fold_numeric for Count. Either add a comment explaining this is defensive programming for future maintainability, or remove the unreachable Count case entirely. Verify by checking the call paths to ensure Count never reaches fold_numeric through any code path.

============================================================================
File: sea-core/fix_api_v2.py
Line: 253 to 256
Type: nitpick

[ ] Task:
In sea-core/fix_api_v2.py around lines 168 to 170 in EntityTransformer._find_entity_new_calls, the code accesses function_node text without verifying its type like the other block at lines 253â€“256; add the same defensive check: ensure function_node is truthy and function_node.type == 'scoped_identifier' before calling self._node_text(function_node).decode() and comparing to 'Resource::new', so the method mirrors the robustness used at lines 253â€“256.

============================================================================
File: sea-core/fix_api_v2.py
Line: 401 to 404
Type: potential_issue

============================================================================
File: sea-core/fix_api_v2.py
Line: 48 to 62
Type: potential_issue

[ ] Task:
In sea-core/fix_api_v2.py around lines 48 to 62, the code creates a hardcoded /tmp/rollback and writes the full source into the log which can fail on non-Unix systems and leak sensitive data; replace the hardcoded path with a secure portable temp directory (use tempfile.mkdtemp() or tempfile.TemporaryDirectory() or join tempfile.gettempdir() with a safe subdir), ensure you handle permission errors and fall back gracefully (try/except and log if rollback dir cannot be created), and remove or gate the code that writes the entire source file to the log (either omit that write entirely or write only non-sensitive snippets or a note that source was omitted) so sensitive data is not leaked.

============================================================================
File: sea-core/fix_api_v2.py
Line: 458 to 474
Type: nitpick

[ ] Task:
In sea-core/fix_api_v2.py around lines 458 to 474, the current backup naming filepath.with_suffix(filepath.suffix + '.bak') can overwrite prior backups (e.g., file.rs.bak); change the backup naming to include a unique suffix such as a timestamp (ISO8601 safe: YYYYMMDD_HHMMSS) or a short UUID appended before the .bak (e.g., originalname.rs.20251113_153012.bak) while preserving the original suffix; construct the backup filename deterministically, create the copy with shutil.copy2, and return the new Path; optionally ensure the timestamp/UUID format is filesystem-safe and handle collisions by retrying with a new identifier.

============================================================================
File: sea-core/fix_api_v2.py
Line: 631
Type: potential_issue

[ ] Task:
In sea-core/fix_api_v2.py around line 631, the current check uses a substring test ('resource' in parsed_args.transform) which is fragile; change it to an explicit comparison such as checking parsed_args.transform == 'resource' or parsed_args.transform == 'all' (or adjust to explicit membership if transform is a list) so the requirement for importing 'resource' is determined by exact transform values rather than substring matching.

============================================================================
File: .gitignore
Line: 73 to 110
Type: potential_issue

[ ] Task:
In .gitignore around lines 73 to 110, remove the duplicated "Auto-generated entries" block (node_modules, npm-debug.log, yarn-debug.log, yarn-error.log, dist/, build/, .log, .env, .env., !.env.example, .vscode/, .idea/, .swp, .swo, .DS_Store, Thumbs.db, .tmp, .temp, .cache/, etc.) so those patterns remain only once earlier in the file, and append/keep only the genuinely new patterns (.bak and .bak.coderabbit.yml) in this region; ensure there are no blank or repeated entries left and preserve any existing negation lines (e.g., !.env.example).

============================================================================
File: sea-core/src/policy/quantifier.rs
Line: 533 to 550
Type: potential_issue

[ ] Task:
In sea-core/src/policy/quantifier.rs around lines 533 to 550, when target_unit is Some but source_unit is None the code silently skips conversion which can produce incorrect results; add validation so that if target_unit.is_some() and source_unit.is_none() the function returns an Err with a clear message indicating conversion cannot proceed because values lack units; keep the existing conversion logic when source_unit is Some, and ensure the new error path uses the same error type/formatting used elsewhere (e.g., map_err(|e| format!("{}", e)) style) so call sites receive a consistent error.

============================================================================
File: sea-core/src/policy/quantifier.rs
Line: 156 to 166
Type: potential_issue

[ ] Task:
In sea-core/src/policy/quantifier.rs around lines 156 to 166, the code incorrectly compares object (a Box) to var (&str); change the check to pattern-match the boxed expression to Expression::Variable(name) and compare name == var (deref the Box or match object). If it matches, perform the existing field lookup on value and return the Literal; otherwise keep the existing fallback (return self.clone() or reconstruct the MemberAccess if needed). Ensure you handle the Box pattern correctly (e.g. match &object or match &object) and compare the variable name string to var.

============================================================================
File: sea-core/fix_api_v2.py
Line: 617 to 619
Type: nitpick

[ ] Task:
In sea-core/fix_api_v2.py around lines 617-619, the file extension check if filepath.suffix not in {'.rs'}: ... continue is redundant when iterating rglob('*.rs') (already filtered) but still required when running in --file (single file) mode; remove the check from the directory-processing loop and instead perform the suffix validation at the single-file handling branch (i.e., after parsing the CLI/file input, if processing a single file then warn/error and skip/exit when filepath.suffix != '.rs'), keeping the warning message and behavior the same.

============================================================================
File: sea-core/src/policy/quantifier.rs
Line: 209 to 214
Type: nitpick

[ ] Task:
In sea-core/src/policy/quantifier.rs around lines 209 to 214, the error message for failing to convert a flow's quantity to f64 lacks the flow identifier; update the format! call to include the flow's ID (e.g., use f.id() or f.flow_id() as appropriate) in the error string so it reads something like "Failed to convert flow quantity {} to f64 for flow id {:?}" and pass the flow id as an additional argument; ensure you use the correct accessor and formatting (Debug or Display) that matches the flow ID type.

============================================================================
File: docs/plans/tmp/task-07-fix-api-robustness.md
Line: 90 to 91
Type: potential_issue

[ ] Task:
In docs/plans/tmp/task-07-fix-api-robustness.md around lines 90 to 91, the listed dependency and Python requirements are incorrect and will break installs; update the dependency pins and Python version as follows: change tree-sitter==0.25.3 to tree-sitter==0.25.2, replace tree-sitter-languages==1.10.2 with tree-sitter-language-pack==0.10.0, and change the Python requirement text from "Python 3.8+" to "Python 3.10+" so the document reflects the actual supported versions.

============================================================================
File: sea-core/fix_api_v2.py
Line: 286 to 292
Type: potential_issue

[ ] Task:
In sea-core/fix_api_v2.py around lines 286 to 292, the code wraps unit string literals using unit_from_string(...) but hardcodes the namespace as "default".to_string(), creating inconsistent string handling; change the namespace handling to follow the same pattern as unit: detect if the namespace argument node is a string literal and, if so, wrap it with the corresponding namespace_from_string(namespace_text) call (otherwise leave the namespace expression as-is), and use that wrapped_namespace when building new_args so unit and namespace string literals are handled consistently.

============================================================================
File: sea-core/fix_api_v2.py
Line: 414 to 418
Type: potential_issue

[ ] Task:
In sea-core/fix_api_v2.py around lines 414 to 418, the separator logic that determines whether to add a comma before the import name is fragile and doesn't properly account for trailing whitespace, newlines, or comments that might appear before the closing brace. The current code uses rstrip() but this is insufficient. Modify the logic to strip all trailing whitespace and newlines from the before_brace string before checking if it ends with a comma, ensuring the separator decision is based on the actual last non-whitespace character rather than just visible text. Apply more comprehensive whitespace normalization before the endswith() check.

============================================================================
File: sea-core/src/kg.rs
Line: 456 to 469
Type: nitpick

[ ] Task:
In sea-core/src/kg.rs around lines 456 to 469, the function escape_xml is declared pub but is only used internally; change its visibility to private by removing the pub qualifier (i.e., declare it as fn escape_xml(...)) and run cargo build/tests to ensure no external references break; if any other module needs it, instead re-export a private wrapper or move the function into the module that uses it and update imports accordingly.

============================================================================
File: sea-core/src/kg.rs
Line: 285 to 351
Type: potential_issue

[ ] Task:
In sea-core/src/kg.rs around lines 285 to 351, the RDF/XML output declares xmlns:rdfs="<http://domainforge.ai/rdfs#>" which diverges from the Turtle file that uses the standard rdfs namespace; replace the rdfs namespace declaration with the W3C standard "<http://www.w3.org/2000/01/rdf-schema#>" so that rdfs:... elements (e.g. rdfs:label) resolve to the correct standard URIs and preserve interoperability across serializations.

============================================================================
File: sea-core/src/kg.rs
Line: 427 to 454
Type: nitpick

[ ] Task:
In sea-core/src/kg.rs around lines 427 to 454, the local array standard_prefixes is recreated on every call to clean_uri; move this definition out of the function as a top-level const (e.g. const STANDARD_PREFIXES: [(&str, &str); 6] = [("rdf", "..."), ...];) or a static slice so it is stored in static memory, then update clean_uri to iterate over STANDARD_PREFIXES instead of creating the array each call; ensure the const has the same entries and types (&str,&str) and update any variable names accordingly.

============================================================================
File: sea-core/src/kg.rs
Line: 353 to 372
Type: nitpick

[ ] Task:
In sea-core/src/kg.rs around lines 353 to 372, the helper escape_turtle_literal is declared pub but is only used internally; change its visibility from pub fn escape_turtle_literal(...) to fn escape_turtle_literal(...) so it is private (leave uri_encode as-is since it is already private); ensure no external references rely on this function and run cargo check to confirm no visibility errors.

Review completed âœ”
